services:
  icecast:
    image: moul/icecast
    container_name: radio_masina_icecast
    ports:
      - 8000:8000
    environment:
      - ICECAST_SOURCE_PASSWORD=changeme
      - ICECAST_ADMIN_PASSWORD=changeme
      - ICECAST_PASSWORD=changeme
      - ICECAST_RELAY_PASSWORD=changeme
    networks:
      - basic-network

  liquidsoap:
    image: savonet/liquidsoap:v2.2.5 #savonet/liquidsoap:rolling-release-v2.3.x 
    container_name: radio_masina_liquidsoap
    restart: always
    command: ["/radio.liq"]
    user: "1000:1000"
    ports:
      - 7001:7001
    environment:
      - ICECAST_PASSWORD=changeme
      - ICECAST_HOST=icecast
    depends_on:
      - icecast
    volumes:
      - ./music:/music
      - ./radio.liq:/radio.liq
      - ./jingles:/jingles
      - ./intros:/intros
    networks:
      - basic-network

  radio_masina_app:
    build: .
    container_name: radio_masina_app
    restart: always
    depends_on:
      - liquidsoap
    volumes:
      - ./music:/music
      - ./jingles:/jingles
      - ./intros:/intros
    environment:
      - OPENAI_API_KEY=
      - OPENAI_CHAT_API_URL=https://api.openai.com/v1/chat/completions
      - OPENAI_TTS_API_URL=https://api.openai.com/v1/audio/speech
      - OPENAI_VOICE=nova
      - ICECAST_HOST=icecast
      - ICECAST_PORT=8000
      - ICECAST_USER=admin
      - ICECAST_PASSWORD=changeme
      - ICECAST_MOUNT=radio
      - LIQUIDSOAP_HOST=liquidsoap
      - LIQUIDSOAP_PORT=7001
      - RADIO_NAME=Basic Radio
      - DJ_NAME=DJ Ma≈°ina
      - MUSIC_DIR=/music
      - JINGLES_DIR=/jingles
      - INTROS_DIR=/intros
      - DJ_DEMEANOR=Fun and Energetic
      - DJ_GENDER=Female
      - DJ_LANGUAGE=Bosnian
    networks:
      - basic-network

  # file_watcher:
  #   build:
  #     context: .
  #     dockerfile: Dockerfile.file_watcher
  #   container_name: radio_masina_file_watcher
  #   restart: always
  #   volumes:
  #     - ./radio.liq:/radio.liq
  #     - /var/run/docker.sock:/var/run/docker.sock
  #   depends_on:
  #     - liquidsoap
  #   networks:
  #     - basic-network

networks:
  basic-network:
    driver: bridge